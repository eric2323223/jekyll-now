# æ·±å…¥æµ…å‡ºç­–ç•¥æ¢¯åº¦(Policy Gradient)

å¼ºåŒ–å­¦ä¹ (Reinforcement Learning)æ˜¯ä¸€ç±»ç”¨äºå¤æ‚åœºæ™¯çš„å­¦ä¹ ç®—æ³•ï¼Œè¢«å¹¿æ³›åº”ç”¨åœ¨æœºå™¨æ§åˆ¶ä»»åŠ¡ã€‚è¿‘å‡ å¹´æ¥ï¼Œéšç€ç¥ç»ç½‘ç»œçš„é‡æ–°å…´èµ·ï¼Œå¼ºåŒ–å­¦ä¹ ä¹Ÿè¢«é€æ¸åº”ç”¨åœ¨ä¸€äº›æ–°çš„é¢†åŸŸï¼Œæ¯”å¦‚è‡ªåŠ¨é©¾é©¶ï¼Œè®¡ç®—æœºè§†è§‰ç­‰ã€‚Alpha GO æˆ˜èƒœäººç±»æ£‹æ‰‹æ ‡å¿—ç€æœºå™¨å­¦ä¹ ç‰¹åˆ«æ˜¯å¼ºåŒ–å­¦ä¹ æ­£åœ¨æˆä¸ºé€æ¸æˆç†Ÿå¹¶èƒ½å¤Ÿå¤„ç†æ›´åŠ å¤æ‚çš„é—®é¢˜ï¼Œæˆä¸ºç ”ç©¶çš„çƒ­ç‚¹ï¼Œä¹Ÿè¢«è®¤ä¸ºèƒ½å¤Ÿåœ¨æœªæ¥åœ¨äººå·¥æ™ºèƒ½é¢†åŸŸå–å¾—çªç ´çš„æ–¹å‘ä¹‹ä¸€ã€‚æœ¬æ–‡æ—¨åœ¨ä»‹ç»å¼ºåŒ–å­¦ä¹ ä¸­æ¢¯åº¦ç­–ç•¥ï¼ˆPGï¼‰çš„åŸºæœ¬åŸç†ï¼Œç›¸å…³æ¦‚å¿µï¼Œå¹¶ç€é‡ä»‹ç»ä½œè€…åœ¨å­¦ä¹ PGè¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›éš¾ç‚¹å¦‚ç†è§£ç›®æ ‡å‡½æ•°å’Œå®ç°æŠ€æœ¯ã€‚
![](https://media.shellypalmer.com/wp-content/images/2016/03/alphago.jpg)


## å¼ºåŒ–å­¦ä¹ 
Alpha GOæˆ˜èƒœäººç±»è®©å¤§ä¼—æƒŠå¹äºäººå·¥æ™ºèƒ½çš„çªé£çŒ›è¿›çš„åŒæ—¶ï¼Œä¹Ÿè®©äººä¸ç¦å¥½å¥‡æœºå™¨å­¦ä¹ åˆ°åº•æ˜¯å¦‚ä½•å®ç°å¯¹äººç±»çš„è¶…è¶Šï¼Œä¸€æ–¹é¢ä¼ ç»Ÿçš„ç›‘ç£å¼å­¦ä¹ (supervised learning)çš„æ•ˆæœå—é™äºè®­ç»ƒæ•°æ®ï¼Œ å¦ä¸€æ–¹é¢é‡‡ç”¨ç®€å•ç©·ä¸¾çš„æ–¹å¼ä¼šé‡åˆ°ç¡¬ä»¶çš„é™åˆ¶ï¼ˆå›´æ£‹çš„çŠ¶æ€ç»„åˆç©ºé—´$10^{360}$è¾¾åˆ°äº†å®‡å®™ç²’å­çš„æ•°é‡çº§ï¼‰ã€‚å…¶å®Alpha GOçš„ä¸€ä¸ªç§˜å¯†æ­¦å™¨å°±æ˜¯ä»Šå¤©çš„ä¸»è§’-å¼ºåŒ–å­¦ä¹ ã€‚å¼ºåŒ–å­¦ä¹ è¯ç”Ÿäºä¸Šä¸–çºª80å¹´ä»£ï¼Œå¼€å§‹åº”ç”¨äºåˆ¶é€ ä¸šï¼Œç‰¹åˆ«æ˜¯å·¥ä¸šæœºå™¨äººçš„è‡ªåŠ¨æ§åˆ¶ï¼ˆè¾¾åˆ°ç±»ä¼¼boston dynamics çš„æœºå™¨ç‹—çš„åŠ¨ä½œæ§åˆ¶æ•ˆæœï¼‰ï¼Œè¿‘å¹´æ¥éšç€å…¶ä»–æœºå™¨æ–¹æ³•çš„æµè¡Œå¼€å§‹åº”ç”¨äºæ›´åŠ â€œæ™ºèƒ½â€çš„åœºæ™¯ï¼Œé™¤äº†å¤§åé¼é¼çš„Alpha GOï¼Œgoogle deepmindå›¢é˜Ÿè¿˜åº”ç”¨å¼ºåŒ–å­¦ä¹ å®ç°äº†è®¡ç®—æœºè‡ªä¸»å­¦ä¹ ç©Atariç³»åˆ—ç”µå­æ¸¸æˆå¹¶è¶…è¶Šäº†äººç±»ä¸‡å®¶çš„æ°´å¹³ï¼Œ**ã€‚è¶Šæ¥è¶Šå¤šæˆåŠŸçš„åº”ç”¨è¡¨æ˜å¼ºåŒ–å­¦ä¹  --
### ![](https://fm.cnbc.com/applications/cnbc.com/resources/img/editorial/2017/11/13/104838704-spot.1910x1000.png?v=1510586396)

å¼ºåŒ–å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œä½†æ˜¯å®ƒä¸æˆ‘ä»¬å¸¸è§ç›‘ç£å¼å­¦ä¹ ï¼ˆsupervised learningï¼‰ä¸å¤ªä¸€æ ·ã€‚ä»å­¦ä¹ æ–¹å¼ä¸Šè®²å¼ºåŒ–å­¦ä¹ æ›´åŠ æ¥è¿‘äººç±»çš„å­¦ä¹ ï¼Œè®°å¾—æˆ‘å°æ—¶å€™ç©æ–°çš„ç”µå­æ¸¸æˆçš„æ—¶å€™è™½ç„¶çœ‹ä¸æ‡‚å±å¹•çš„æç¤ºä½†æ˜¯ç»è¿‡è‡ªå·±çš„æ‘¸ç´¢ä¹Ÿèƒ½æŒæ¡æ¸¸æˆæ–¹æ³•ï¼Œè¿™ä¸ªæ‘¸ç´¢çš„è¿‡ç¨‹å…¶å®å°±æ˜¯é€šè¿‡è¯•é”™é€æ¸äº†è§£æ¸¸æˆè§„åˆ™çš„å­¦ä¹ è¿‡ç¨‹ï¼Œå¼ºåŒ–å­¦ä¹ ä¹Ÿæ˜¯é€šè¿‡ä¸€ç³»åˆ—çš„å°è¯•å¹¶é€šè¿‡å¾—åˆ°çš„åé¦ˆä¸æ–­è°ƒæ•´è‡ªå·±çš„è¡Œä¸ºæ¥å­¦ä¹ é™Œç”Ÿçš„ç¯å¢ƒã€‚
å¼ºåŒ–å­¦ä¹ å¯ä»¥è¢«å½¢å¼åŒ–çš„æè¿°ä¸ºMarkovå†³ç­–è¿‡ç¨‹(MDP)ï¼Œç”±ä»¥ä¸‹å‡ éƒ¨åˆ†ç»„æˆï¼š
-   **$S$** : çŠ¶æ€é›†ï¼ŒSet of states. At each time step the state of the environment is an element  $s \in  S$.
-   **$A$**: åŠ¨ä½œé›† Set of actions. At each time step the agent choses an action  $a \in  A$ to perform.
-   **$p(s_{t+1} | s_t, a_t)$** : State transition model that describes how the environment state changes when the user performs an action  `a`depending on the action  `a`and the current state st.
-   **$p(r_{t+1} | s_t, a_t)$** : Reward model that describes the real-valued reward value that the agent recieves from the environment after performing an action. In MDP the the reward value depends on the current state and the action performed.
-  **ğ›¾** : æŠ˜æ‰£ç³»æ•°ï¼Œç”¨äºè°ƒæ•´æœªæ¥å¯¹å½“å‰çš„å½±å“

å¼ºåŒ–å­¦ä¹ çš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªé€šè¿‡å’Œç¯å¢ƒäº¤äº’è·å¾—åé¦ˆï¼Œå†æ ¹æ®è¿”å›è°ƒæ•´ä»¥æœŸä½¿æ€»å¥–åŠ±æœ€å¤§åŒ–çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªå¤šæ­¥(multi-timestep)çš„äº¤äº’çš„è¿‡ç¨‹ï¼Œæ¯ä¸€æ­¥äº¤äº’éƒ½ä¼šå½±å“å…¶åçš„æ‰€æœ‰æ­¥éª¤ã€‚å¼ºåŒ–å­¦ä¹ ä¸­çš„ä¸€æ¬¡äº¤äº’æ˜¯æŒ‡Agent å¯¹ç¯å¢ƒæ–½åŠ ä¸€ä¸ªåŠ¨ä½œï¼Œè¿™ä¼šå¯¼è‡´ç¯å¢ƒçš„çŠ¶æ€å‘ç”Ÿæ”¹å˜å¹¶ä¸”ç”±ç¯å¢ƒå›é¦ˆç»™Agentä¸€ä¸ªå¥–åŠ±ï¼ˆå¥–åŠ±æ—¢å¯ä»¥æ˜¯æ­£å‘çš„ä¹Ÿå¯ä»¥æ˜¯è´Ÿå‘çš„ï¼‰ï¼Œå¼ºåŒ–å­¦ä¹ çš„ç›®æ ‡å°±æ˜¯å¯»æ‰¾ä¸€ä¸ªæœ€ä¼˜çš„ç­–ç•¥ä½¿å¾—æ•´ä¸ªå­¦ä¹ è¿‡ç¨‹ï¼ˆä»å¼€å§‹çŠ¶æ€åˆ°ç»ˆç»“çŠ¶æ€ï¼‰è·å¾—çš„å¥–åŠ±æœ€å¤§åŒ–ã€‚

![](https://atariage.com/2600/hacks/screenshots/s_SpaceInvaders_RK_Hack_2.png)
å¼ºåŒ–å­¦ä¹ å®ƒåŒ…æ‹¬å¦‚ä¸‹å›¾æ‰€ç¤ºçš„å‡ ä¸ªéƒ¨åˆ†ï¼š
![](https://cdn-images-1.medium.com/max/1600/1*c3pEt4pFk0Mx684DDVsW-w.png)
~~1.  ä¸»ä½“(Agent) æŒ‡èƒ½å¤Ÿé€šè¿‡åŠ¨ä½œä¸ç¯å¢ƒäº¤äº’çš„**ï¼Œåœ¨RLçš„ç¯å¢ƒä¸­ä¸»ä½“é€šå¸¸æ˜¯è¿è¡Œä¸­çš„ç®—æ³•ï¼Œæ¯”å¦‚åœ¨Atariæ¸¸æˆä¸­çš„ä¸»ä½“æ˜¯ç”¨äºæ§åˆ¶é£èˆ¹çš„ç®—æ³•
2.  ç¯å¢ƒ(Environment) æŒ‡ä¸»ä½“åŠ¨ä½œä½œç”¨çš„å¯¹è±¡ï¼Œ æ¯”å¦‚Atariæ¸¸æˆæœ¬èº«ã€‚
3.  åŠ¨ä½œ (Action): æŒ‡æ‰€æœ‰å¯èƒ½çš„ä½œç”¨äºç¯å¢ƒä¸Šçš„æ“ä½œï¼Œæ¯”å¦‚Atariæ¸¸æˆä¸­ç®—æ³•æ§åˆ¶é£èˆ¹è¿›è¡Œç§»åŠ¨æˆ–å°„å‡»ã€‚
4.  çŠ¶æ€ (State): æŒ‡å¯è¢«ä¸»ä½“æ„ŸçŸ¥çš„å…³äºç¯å¢ƒçš„ä¿¡æ¯ï¼Œæ¯”å¦‚Atariæ¸¸æˆä¸­å±å¹•æ˜¾ç¤ºçš„æ‰€æœ‰ç‰©ä½“çš„ä½ç½®ä»¥åŠç§»åŠ¨æ–¹å‘å’Œé€Ÿåº¦ä¿¡æ¯
5.  å¥–åŠ± (Reward): æŒ‡ç”±ç¯å¢ƒå›é¦ˆç»™ä¸»ä½“çš„æè¿°ä¸Šä¸€ä¸ªåŠ¨ä½œæ•ˆæœçš„ä¿¡æ¯ï¼Œæ¯”å¦‚Atariæ¸¸æˆä¸­é£èˆ¹åŠ¨ä½œå¯¼è‡´çš„å¾—åˆ†å˜åŒ–ã€‚~~


~~åœ¨å®ç°ä¸Šï¼Œå¼ºåŒ–å­¦ä¹ æ˜¯ä¸€ä¸ªé€šè¿‡å¤šä¸ªè½®æ¬¡é€æ¸ä¼˜åŒ–ç®—æ³•å‚æ•°æ¥å¢å¼ºå­¦ä¹ æ•ˆæœçš„è¿‡ç¨‹ï¼Œæ¯ä¸ªè½®æ¬¡åŒ…å«ä¸¤éƒ¨åˆ†ï¼šå‰å‘ä¼ é€’å’Œåå‘ä¼ é€’ã€‚å¤„äºåˆå§‹çŠ¶æ€çš„Agentæ ¹æ®ç®—æ³•çš„å½“å‰å‚æ•°ç”ŸæˆåŠ¨ä½œä½œç”¨äºç¯å¢ƒï¼Œç¯å¢ƒè¿”å›ç»™Agentæ–°çš„çŠ¶æ€å’Œå¯¹åŠ¨ä½œçš„å¥–åŠ±ï¼Œåœ¨è½®æ¬¡ç»“æŸåç®—æ³•é€šè¿‡æ±‡æ€»æ‰€æœ‰åœ¨æœ¬è½®æ”¶é›†åˆ°çš„åé¦ˆè°ƒæ•´ç®—æ³•çš„å‚æ•°å¼€å§‹ä¸‹ä¸€è½®çš„å­¦ä¹ ï¼Œç›´åˆ°å­¦ä¹ çš„æ•ˆæœä¸å†å¢é•¿ã€‚å¸¸è§çš„å¼ºåŒ–å­¦ä¹ æœ‰ä¸¤ç±»ï¼šåŸºäºå€¼çš„æ–¹æ³•å’ŒåŸºäºç­–ç•¥çš„æ–¹æ³•ã€‚~~

~~åŸºäºå€¼çš„æ–¹æ³•ï¼ŒåŸºäºå€¼çš„æ–¹æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯æ±‚ä¸€ä¸ªå‡½æ•°Qæ»¡è¶³bellmanæ–¹ç¨‹ï¼Œä½¿å¾—åœ¨çŠ¶æ€$s$ä¸‹ä½¿ç”¨åŠ¨ä½œ$a$å¯èƒ½å¾—åˆ°æœ€å¤§çš„å¥–åŠ±
$$
Q(s,a) = r + \gamma max_{a'} Q(s', a')
$$
å…¶ä¸­ï¼Œ$s'$è¡¨ç¤ºåœ¨å½“å‰çŠ¶æ€$s$ä¸‹ä½¿ç”¨åŠ¨ä½œ$a$å¾—åˆ°çš„ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œ$\gamma$è¡¨ç¤ºå¯¹æœªæ¥äº‹ä»¶çš„æŠ˜æ‰£ç‡ï¼Œbellmanæ–¹ç¨‹æè¿°äº†ä¸€ä¸ªé€’å½’çš„è®¡ç®—æ–¹æ³•ï¼Œå³$s$çŠ¶æ€åœ¨ä½¿ç”¨$a$åŠ¨ä½œå¾—åˆ°çš„æ€»å¥–åŠ±ç­‰äºå½“å‰çš„ç›´æ¥å¥–åŠ±$r$å’Œä¸‹ä¸€æ­¥åŠ¨ä½œ$a'$äº§ç”Ÿçš„æ€»å¥–åŠ±çš„å’Œã€‚
åŸºäºå€¼çš„æ–¹æ³•æœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰¹ç‚¹ï¼š
- ç»´æŠ¤çŠ¶æ€
- ç¡®å®šæ€§
ä»è¿™ä¸ªæ–¹ç¨‹å¯çŸ¥ï¼Œä¸ºäº†è®¡ç®—$s$çŠ¶æ€ä¸‹çš„æœ€å¤§å¥–åŠ±ï¼Œéœ€è¦æ±‚å¤„å…¶åæ‰€æœ‰çŠ¶æ€çš„æ€»å¥–åŠ±ã€‚~~

å¼ºåŒ–å­¦ä¹ åŒ…æ‹¬äº†ä¸€ç³»åˆ—ä¸åŒçš„ç®—æ³•ï¼Œå…¶ä¸­æ¯”è¾ƒå¸¸è§çš„æ˜¯åŸºäºå€¼ï¼ˆValue-basedï¼‰çš„æ–¹æ³•å’ŒåŸºäºç­–ç•¥ï¼ˆPolicy-basedï¼‰çš„æ–¹æ³•ã€‚è¿™ä¸¤ç±»æ–¹æ³•å„æœ‰ç‰¹ç‚¹ï¼Œé€‚ç”¨äºè§£å†³ä¸åŒçš„é—®é¢˜ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒåŸºäºå€¼çš„æ–¹æ³•é€‚ç”¨äºæ¯”è¾ƒç®€å•ï¼ˆçŠ¶æ€ç©ºé—´æ¯”è¾ƒå°ï¼‰çš„é—®é¢˜ï¼Œå®ƒæœ‰è¾ƒé«˜çš„æ•°æ®åˆ©ç”¨ç‡å¹¶ä¸”èƒ½ç¨³å®šæ”¶æ•›ï¼›è€Œæ–¹æ³•åŸºäºç­–ç•¥çš„æ–¹æ³•é€‚ç”¨äºå¤æ‚é—®é¢˜ï¼Œä½†æ˜¯é«˜æ–¹å·®æ˜¯è¿™ç±»æ–¹æ³•ä¸€ä¸ªæ¯”è¾ƒæ˜æ˜¾çš„é—®é¢˜ã€‚æœ¬æ–‡ä»‹ç»çš„ç­–ç•¥æ¢¯åº¦å°±æ˜¯ä¸€ç§çš„æœ€åŸºæœ¬çš„åŸºäºç­–ç•¥çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸‹é¢ä¼šä»åŸç†ã€å®ç°å’Œæ”¹è¿›è¿™å‡ æ–¹é¢è¿›è¡Œä»‹ç»ã€‚

![](https://yanpanlau.github.io/img/torcs/actor-critic.png)


## ç­–ç•¥æ¢¯åº¦ï¼ˆPGï¼‰
### PGçš„åŸºæœ¬åŸç†
åŸºäºå€¼çš„æ–¹æ³•å¯ä»¥ç›´æ¥è®¡ç®—å¥–åŠ±ä»è€Œå¯ä»¥å¾—åˆ°æœ€ä¼˜è§£ï¼Œç»™å®šä¸€ä¸ªçŠ¶æ€å°±èƒ½è®¡ç®—å‡ºæ¯ç§å¯èƒ½åŠ¨ä½œçš„å¥–åŠ±ï¼Œä½†è¿™ç§ç¡®å®šæ€§çš„æ–¹æ³•æ°æ°æ— æ³•å¤„ç†ä¸€äº›ç°å®çš„åšå¼ˆé—®é¢˜ï¼Œæ¯”å¦‚ç©100æŠŠçŸ³å¤´å‰ªåˆ€å¸ƒçš„æ¸¸æˆï¼Œæœ€å¥½çš„è§£æ³•æ˜¯éšæœºçš„ä½¿ç”¨çŸ³å¤´ã€å‰ªåˆ€å’Œå¸ƒå¹¶å°½é‡ä¿è¯è¿™ä¸‰ç§æ‰‹åŠ¿å‡ºç°çš„æ¦‚ç‡ä¸€æ ·ï¼Œå› ä¸ºä»»ä½•ä¸€ç§æ‰‹åŠ¿çš„æ¦‚ç‡é«˜äºå…¶ä»–æ‰‹åŠ¿éƒ½ä¼šè¢«å¯¹æ‰‹æ³¨æ„åˆ°å¹¶ä½¿ç”¨ç›¸åº”çš„æ‰‹åŠ¿èµ¢å¾—æ¸¸æˆã€‚ å†æ¯”å¦‚ä¸‹å›¾è¿™ä¸ªä¾‹å­ï¼š

é‡‡ç”¨åŸºäºå€¼çš„æ–¹æ³•çš„æ–¹æ³•åœ¨ç¡®å®šçš„çŠ¶æ€ä¸‹å°†å¾—åˆ°ç¡®å®šçš„åé¦ˆï¼Œå› æ­¤åœ¨ä½¿ç”¨DQNæ–¹æ³•å†³å®šç°è‰²ï¼ˆçŠ¶æ€ï¼‰æ–¹æ ¼çš„ä¸‹ä¸€æ­¥åŠ¨ä½œï¼ˆå·¦æˆ–å³ï¼‰çš„ç¡®å®šçš„ï¼Œå³æ€»æ˜¯å‘å·¦å°†å¿…ç„¶ä¼šå¯¼è‡´ã€‚äº‹å®ä¸Šå¾ˆå¤šå®é™…çš„éƒ½æœ‰ç±»ä¼¼çš„ç‰¹å¾ï¼Œå³
![](https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSAR5v0c1CoJWvM0pQheKtpfuT0seDTIsfcnlBZncyvf_FhZENQ)
å¦å¤–ï¼Œæœ‰é™çš„çŠ¶æ€æ•°é‡ä¹Ÿæ˜¯ä½¿ç”¨DQNçš„ä¸€ä¸ªå¤§é—®é¢˜ï¼Œå› ä¸ºåŸºäºå€¼çš„æ–¹æ³•éœ€è¦ä¿å­˜çŠ¶æ€è¡¨ï¼ˆæ‰€æœ‰çŠ¶æ€-åŠ¨ä½œçš„å¯¹åº”å…³ç³»ï¼‰ï¼Œå› æ­¤å¾ˆå¤šç°å®é—®é¢˜ï¼ˆä¾‹å¦‚æœºå™¨äººæ§åˆ¶å’Œè‡ªåŠ¨é©¾é©¶éƒ½æ˜¯è¿ç»­åŠ¨ä½œç©ºé—´ï¼‰ï¼Œéƒ½å› ä¸ºå·¨é‡çš„çŠ¶æ€è€Œæ— æ³•è®¡ç®—ã€‚
é‚£ä¹ˆå¦‚ä½•è§£å†³ä¸Šé¢çš„ä¸¤ä¸ªé—®é¢˜å‘¢ï¼Ÿæœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•èƒ½åœ¨ç¡®å®šçš„çŠ¶æ€ä¸‹å¾—åˆ°ä¸åŒçš„åŠ¨ä½œå‘¢ï¼Ÿåˆæœ‰ä»€ä¹ˆæ–¹æ³•èƒ½é¿å…ç»´æŠ¤åºå¤§çš„çŠ¶æ€è¡¨å‘¢ï¼Ÿ
ç®€å•æ¥è¯´ï¼ŒPGåˆ™é‡‡å–äº†éšæœºï¼ˆstochasticï¼‰çš„æ–¹å¼è§£å†³äº†ä¸Šè¿°2ä¸ªé—®é¢˜ã€‚é¦–å…ˆéšæœºèƒ½æä¾›éç¡®å®šçš„ç»“æœï¼Œä½†è¿™ç§éç¡®å®šçš„ç»“æœå¹¶ä¸æ˜¯å®Œå…¨çš„éšæœºè€Œæ˜¯æœä»æŸç§æ¦‚ç‡åˆ†å¸ƒçš„éšæœºï¼ŒPGä¸è®¡ç®—rewardè€Œæ˜¯ä»¥ç›´æ¥ä½¿ç”¨ç­–ç•¥é€‰æ‹©actionï¼Œè¿™æ ·å°±é¿å…äº†å› ä¸ºè®¡ç®—å¥–åŠ±è€Œç»´æŠ¤çŠ¶æ€è¡¨ã€‚ 
é‚£ä¹ˆPGçš„å­¦ä¹ åˆ°åº•æ˜¯æ€æ ·çš„å‘¢ï¼Ÿåœ¨è§£é‡Šè¿™ä¸ªè¿‡ç¨‹ä¹‹å‰å…ˆä»‹ç»å‡ ä¸ªæ¦‚å¿µï¼š
**å¯¹è±¡ç³»ç»Ÿ**ï¼šå°±æ˜¯PGçš„å­¦ä¹ å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å³å¯ä»¥æ˜¯ä¸€ä¸ªç³»ç»Ÿï¼Œæ¯”å¦‚æ±½è½¦æˆ–ä¸€ä¸ªæ¸¸æˆï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå¯¹æ‰‹ï¼Œæ¯”å¦‚åŠ¿å¤´å‰ªåˆ€å¸ƒçš„æ¸¸æˆå¯¹æ‰‹æˆ–è€…ä¸€ä¸ªèŒä¸šçš„å›´æ£‹æ‰‹ã€‚
~~MDP:Reward function~~
**Policyç­–ç•¥** $\pi_\theta(a|s)$ è¡¨ç¤ºåœ¨çŠ¶æ€$s$å’Œå‚æ•°$\theta$æ¡ä»¶ä¸‹å‘ç”ŸåŠ¨ä½œ$a$çš„æ¦‚ç‡
**Episodeè½®æ¬¡**: è¡¨ç¤ºä»èµ·å§‹çŠ¶æ€å¼€å§‹ä½¿ç”¨æŸç§ç­–ç•¥äº§ç”ŸåŠ¨ä½œä¸å¯¹è±¡ç³»ç»Ÿäº¤äº’ï¼Œç›´åˆ°æŸä¸ªç»ˆç»“çŠ¶æ€ç»“æŸã€‚æ¯”å¦‚åœ¨å›´æ£‹æ¸¸æˆä¸­çš„ä¸€ä¸ªè½®æ¬¡å°±æ˜¯ä»æ£‹ç›˜ä¸­çš„ç¬¬ä¸€ä¸ªè½å­å¼€å§‹ç›´åˆ°å¯¹å¼ˆåˆ†å‡ºèƒœè´Ÿï¼Œæˆ–è€…è‡ªåŠ¨é©¾é©¶çš„è½®æ¬¡æŒ‡ä»æ±½è½¦å¯åŠ¨ä¸€ç›´åˆ°é¡ºåˆ©æŠµè¾¾æŒ‡å®šçš„ç›®çš„åœ°ï¼Œå½“ç„¶æ’è½¦æˆ–è€…å¼€è¿›æ°´å¡˜ä¹Ÿæ˜¯ç§ä¸ç†æƒ³çš„ç»ˆç»“çŠ¶æ€ã€‚
**è½®æ¬¡å¥–åŠ±**ï¼š
**Trajectoryè½¨è¿¹** $\tau$ è¡¨ç¤ºåœ¨PGä¸€ä¸ªè½®æ¬¡çš„å­¦ä¹ ä¸­çŠ¶æ€$s$ï¼ŒåŠ¨ä½œ$a$å’Œå¥–åŠ±$r$çš„é¡ºåºæ’åˆ—
$$
\tau = (s_0, a_0, r_0, s_1, a_1, r_1, ... , s_t, a_t, r_t)
$$
ç”±äºç­–ç•¥äº§ç”Ÿçš„æ˜¯éç¡®å®šçš„åŠ¨ä½œï¼ŒåŒä¸€ä¸ªç­–ç•¥åœ¨å¤šä¸ªè½®æ¬¡å¯ä»¥äº§ç”Ÿå¤šä¸ªä¸åŒçš„è½¨è¿¹ã€‚~~å› æ­¤åœ¨å®ç°ä¸­å¯¹æ¯ä¸ªç­–ç•¥ä¼šæ±‚å¤šä¸ªè½®æ¬¡çš„å¹³å‡å€¼~~

>å¦‚æœAgentçš„æŸä¸ªè¡Œä¸ºç­–ç•¥å¯¼è‡´ç¯å¢ƒæ­£çš„å¥–èµ(å¼ºåŒ–ä¿¡å·)ï¼Œé‚£ä¹ˆAgentä»¥åäº§ç”Ÿè¿™ä¸ªè¡Œä¸ºç­–ç•¥çš„è¶‹åŠ¿ä¾¿ä¼šåŠ å¼ºã€‚Agentçš„ç›®æ ‡æ˜¯åœ¨æ¯ä¸ªç¦»æ•£çŠ¶æ€å‘ç°æœ€ä¼˜ç­–ç•¥ä»¥ä½¿æœŸæœ›çš„æŠ˜æ‰£å¥–èµå’Œæœ€å¤§ã€‚
å¼ºåŒ–å­¦ä¹ æŠŠå­¦ä¹ çœ‹ä½œè¯•æ¢è¯„ä»·è¿‡ç¨‹ï¼ŒAgenté€‰æ‹©ä¸€ä¸ªåŠ¨ä½œç”¨äºç¯å¢ƒï¼Œç¯å¢ƒæ¥å—è¯¥åŠ¨ä½œåçŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼ŒåŒæ—¶äº§ç”Ÿä¸€ä¸ªå¼ºåŒ–ä¿¡å·(å¥–æˆ–æƒ©)åé¦ˆç»™Agentï¼ŒAgentæ ¹æ®å¼ºåŒ–ä¿¡å·å’Œç¯å¢ƒå½“å‰çŠ¶æ€å†é€‰æ‹©ä¸‹ä¸€ä¸ªåŠ¨ä½œï¼Œé€‰æ‹©çš„åŸåˆ™æ˜¯ä½¿å—åˆ°æ­£å¼ºåŒ–(å¥–)çš„æ¦‚ç‡å¢å¤§ã€‚é€‰æ‹©çš„åŠ¨ä½œä¸ä»…å½±å“ç«‹å³å¼ºåŒ–å€¼ï¼Œè€Œä¸”å½±å“ç¯å¢ƒä¸‹ä¸€æ—¶åˆ»çš„çŠ¶æ€åŠæœ€ç»ˆçš„å¼ºåŒ–å€¼ã€‚
å¼ºåŒ–å­¦ä¹ ä¸åŒäºè¿æ¥ä¸»ä¹‰å­¦ä¹ ä¸­çš„ç›‘ç£å­¦ä¹ ï¼Œä¸»è¦è¡¨ç°åœ¨æ•™å¸ˆä¿¡å·ä¸Šï¼Œå¼ºåŒ–å­¦ä¹ ä¸­ç”±ç¯å¢ƒæä¾›çš„å¼ºåŒ–ä¿¡å·æ˜¯Agentå¯¹æ‰€äº§ç”ŸåŠ¨ä½œçš„å¥½åä½œä¸€ç§è¯„ä»·(é€šå¸¸ä¸ºæ ‡é‡ä¿¡å·)ï¼Œè€Œä¸æ˜¯å‘Šè¯‰Agentå¦‚ä½•å»äº§ç”Ÿæ­£ç¡®çš„åŠ¨ä½œã€‚ç”±äºå¤–éƒ¨ç¯å¢ƒæä¾›äº†å¾ˆå°‘çš„ä¿¡æ¯ï¼ŒAgentå¿…é¡»é è‡ªèº«çš„ç»å†è¿›è¡Œå­¦ä¹ ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒAgentåœ¨è¡ŒåŠ¨ä¸€ä¸€è¯„ä»·çš„ç¯å¢ƒä¸­è·å¾—çŸ¥è¯†ï¼Œæ”¹è¿›è¡ŒåŠ¨æ–¹æ¡ˆä»¥é€‚åº”ç¯å¢ƒã€‚
å¼ºåŒ–å­¦ä¹ ç³»ç»Ÿå­¦ä¹ çš„ç›®æ ‡æ˜¯åŠ¨æ€åœ°è°ƒæ•´å‚æ•°ï¼Œä»¥è¾¾åˆ°å¼ºåŒ–ä¿¡å·æœ€å¤§ã€‚è‹¥å·²çŸ¥r/Aæ¢¯åº¦ä¿¡æ¯ï¼Œåˆ™å¯ç›´æ¥å¯ä»¥ä½¿ç”¨ç›‘ç£å­¦ä¹ ç®—æ³•ã€‚å› ä¸ºå¼ºåŒ–ä¿¡å·rä¸Agentäº§ç”Ÿçš„åŠ¨ä½œAæ²¡æœ‰æ˜ç¡®çš„å‡½æ•°å½¢å¼æè¿°ï¼Œæ‰€ä»¥æ¢¯åº¦ä¿¡æ¯r/Aæ— æ³•å¾—åˆ°ã€‚å› æ­¤ï¼Œåœ¨[å¼ºåŒ–å­¦ä¹ ](https://baike.baidu.com/item/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0)ç³»ç»Ÿä¸­ï¼Œéœ€è¦æŸç§éšæœºå•å…ƒï¼Œä½¿ç”¨è¿™ç§éšæœºå•å…ƒï¼ŒAgentåœ¨å¯èƒ½åŠ¨ä½œç©ºé—´ä¸­è¿›è¡Œæœç´¢å¹¶å‘ç°æ­£ç¡®çš„åŠ¨ä½œã€‚


PGçš„å­¦ä¹ æ˜¯ä¸€ä¸ªç­–ç•¥çš„ä¼˜åŒ–è¿‡ç¨‹ï¼Œæœ€å¼€å§‹éšæœºçš„ç”Ÿæˆä¸€ä¸ªç­–ç•¥ï¼Œå½“ç„¶è¿™ä¸ªç­–ç•¥å¯¹å¯¹è±¡ç³»ç»Ÿä¸€æ— æ‰€çŸ¥ï¼Œæ‰€ä»¥ç”¨è¿™ä¸ªç­–ç•¥äº§ç”Ÿçš„åŠ¨ä½œä¼šä»å¯¹è±¡ç³»ç»Ÿé‚£é‡Œå¾ˆå¯èƒ½ä¼šå¾—åˆ°ä¸€ä¸ªè´Ÿé¢å¥–åŠ±ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å¥½åƒæˆ‘ä»¬çš„è‡ªåŠ¨é©¾é©¶ç­–ç•¥åœ¨é¢å¯¹ç¬”ç›´çš„è·¯é¢è€Œäº§ç”Ÿå³è½¬çš„åŠ¨ä½œå¯¼è‡´æ±½è½¦æ’ä¸Šè·¯è¾¹çš„è¡Œäººè¿™æ ·çš„ä¸¥é‡åæœã€‚ä¸ºäº†æ›´å¥½çš„é©¾é©¶æ±½è½¦PGéœ€è¦ä¸æ–­çš„æ”¹å˜ç­–ç•¥ä»è€Œè·å¾—æ›´é«˜çš„è½®æ¬¡å¥–åŠ±ï¼ˆå®‰å…¨å¿«é€Ÿçš„åˆ°è¾¾ç›®çš„åœ°ï¼‰ï¼ŒPGåœ¨ä¸€è½®çš„å­¦ä¹ ä¸­ä½¿ç”¨åŒä¸€ä¸ªç­–ç•¥ç›´åˆ°è¯¥è½®ç»“æŸï¼Œé€šè¿‡æ¢¯åº¦ä¸Šå‡æ”¹å˜ç­–ç•¥å¹¶å¼€å§‹ä¸‹ä¸€è½®å­¦ä¹ ï¼Œå¦‚æ­¤å¾€å¤ç›´åˆ°è½®æ¬¡ç´¯è®¡å¥–åŠ±ä¸å†å¢é•¿åœæ­¢ã€‚   ~~ä¸€ä¸ªä½¿å¾—actionçš„é€‰æ‹©æœä»ä¸€å®šçš„æ¦‚ç‡åˆ†å¸ƒï¼Œé€šè¿‡ä½¿ç”¨è¿™ä¸ªç­–ç•¥å®Œæˆæ‰€æœ‰äº¤äº’ï¼Œè¿™å°±æŠŠä¸€ä¸ªå¤æ‚çš„å®é™…é—®é¢˜è½¬åŒ–æˆäº†æ¦‚ç‡ä¼˜åŒ–é—®é¢˜~~
![enter image description here](https://github.com/eric2323223/ML/blob/dev/drafts/PG1.PNG?raw=true)

### å®ç°
æˆ‘ä»¬çŸ¥é“åœ¨ç›‘ç£å¼å­¦ä¹ ä¸­ä¸€èˆ¬ä¼šé€‰æ‹©ä¸€ç§loss function, å¦‚square loss, Hinge loss, logistic lossç­‰ï¼Œæ¥è¡¨ç¤ºçœŸå®å€¼å’Œå®é™…å€¼çš„å·®è·ä»è€Œæ®æ­¤åœ¨åå‘ä¼ é€’ä¸­è¿›è¡Œå‚æ•°çš„æ›´æ–°ã€‚åœ¨ç­–ç•¥æ¢¯åº¦å­¦ä¹ ä¸­åŒæ ·éœ€è¦ç±»ä¼¼çš„å‡½æ•°è¡¨ç¤ºå½“å‰çš„æ•ˆæœï¼Œè¿™å°±æ˜¯ç›®æ ‡å‡½æ•°ã€‚
#### PGçš„ç›®æ ‡å‡½æ•°
æ ¹æ®ä¸Šè¿°PGçš„åŸºæœ¬åŸç†ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠPGçš„ç›®æ ‡å½¢å¼åŒ–çš„æè¿°ä¸ºä»¥ä¸‹è¡¨è¾¾å¼

$$
J(\theta) = argmax_\theta \mathbb E[r_0+r_1+r_2+...+r_t|\pi_\theta]  
$$
å…¶ä¸­$\mathbb E[r_0+r_1+r_2+...+r_t|\pi_\theta]$è¡¨ç¤ºåœ¨ç­–ç•¥$\pi_\theta$æ¡ä»¶ä¸‹ä¸€è½®äº¤äº’ï¼ˆ$0$åˆ°$t$æ­¥ï¼‰ä¸­çš„ç´¯è®¡å¥–åŠ±çš„æœŸæœ›å€¼ï¼Œè¿™é‡Œæ˜¯æœŸæœ›è€Œä¸æ˜¯ç¡®å®šå€¼æ˜¯å› ä¸ºæ¯ä¸€æ­¥çš„å¥–åŠ±æ˜¯æ ¹æ®ç­–ç•¥å¾—åˆ°çš„æœŸæœ›å€¼è€Œä¸æ˜¯ç¡®å®šå€¼ã€‚ç”±äº$r_i$å¯ä»¥ç”±$r(\tau_{i-1})$è®¡ç®—å¾—åˆ°ï¼Œå› æ­¤å¯ä»¥æŠŠç´¯è®¡å¥–åŠ±çš„æœŸæœ›å€¼å†™æˆå¦‚ä¸‹ï¼š

$$
J(\theta) = \mathbb E_{\tau\sim \pi_\theta(\tau)}[\sum_t r(\tau)] \approx \frac {1}{N}\sum_i\sum_t r(s_{i,t}, a_{i,t})
$$
æˆ‘ä»¬æŠŠå•ä¸ªè½®æ¬¡çš„ç´¯è®¡å¥–åŠ±ä½œä¸ºPGçš„ç›®æ ‡å‡½æ•°$J(\theta)$ï¼Œåˆ™PGçš„ç›®æ ‡å°±æ˜¯ç¡®å®šæ„æˆç­–ç•¥çš„å‚æ•°$\theta$ä½¿å¾—$J(\theta)$å–å¾—æœ€å¤§çš„æœŸæœ›å€¼

$$
\theta ^* = argmax J(\theta)
$$
å›¾ç‰‡Intuition trajectories.

ç°åœ¨PGçš„å­¦ä¹ å°±å˜æˆäº†ä¸€ä¸ªå¯¹$J(\theta)$æ±‚æœ€å¤§å€¼çš„é—®é¢˜ï¼Œå’Œç›‘ç£å¼å­¦ä¹ ä¸­ä½¿ç”¨çš„æ¢¯åº¦ä¸‹é™(gradient descent)æ±‚æŸå¤±å‡½æ•°(loss function)çš„æœ€å°å€¼ç±»ä¼¼ï¼ŒPGä¸­ä½¿ç”¨æ¢¯åº¦ä¸Šå‡(gradient ascent)æ¥æ›´æ–°$\theta$ã€‚
æ ¹æ®æœŸæœ›å€¼çš„æ•°å­¦å®šä¹‰ï¼Œ

$$
J(\theta) = \mathbb E_{r\sim \pi_\theta(\tau)} [\sum r_\tau]= \int_\tau r(\tau)\pi_\theta(\tau) d\tau
$$
å¯¹è¿™ä¸ªç§¯åˆ†è¡¨è¾¾å¼æ±‚å¯¼æ•°ï¼Œ
$$
\nabla_\theta J(\theta) =  \nabla_\theta \int_\tau r(\tau)\pi_\theta(\tau) d\tau= \int_\tau r(\tau)\nabla_\theta \pi_\theta(\tau) d\tau
$$
ç”±äº$\pi_\theta(\tau)$æœ¬èº«ä¾èµ–äº$\theta$ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥æ±‚å¯¼ï¼Œå› æ­¤è¦ä½¿ç”¨ä¸€ä¸ªå°æŠ€å·§ï¼Œæ ¹æ®$\nabla log f(x)=\frac {\nabla f(x)}{f(x)}$å¯å¾—ä¸‹å¼
$$
\nabla_\theta\pi_\theta(\tau) = \pi_\theta(\tau)\frac{\nabla_\theta\pi_\theta(\tau)}{\pi_\theta(\tau)}=\pi_\theta(\tau)\nabla_\theta log\pi_\theta(\tau)
$$
å› æ­¤
$$
\nabla_\theta J(\theta) =\int r(\tau)\nabla_\theta\pi_\theta(\tau)d\tau = \int r(\tau)\pi_\theta(\tau)\nabla_\theta log\pi_\theta(\tau)d\tau
$$
å†æ ¹æ®æœŸæœ›å€¼çš„å®šä¹‰ï¼Œ
$$
\nabla_\theta J(\theta) =\int r(\tau)\pi_\theta(\tau)\nabla_\theta log\pi_\theta(\tau)d\tau=\mathbb E_{\tau\sim\pi_\theta(\tau)}[\nabla_\theta log\pi_\theta(\tau)r(\tau)]
$$
ç”±äºï¼Œ
$$
log\pi_\theta(\tau) = logp(s_1) + \sum_{t=1}^Tlog\pi_\theta(a_t|s_t)+logp(s_{t+1}|s_t, a_t)
$$
$$
r(\tau)=\sum_{t=1}^Tr(s_t,a_t)
$$
å¯å¾—
$$
\nabla_\theta J(\theta) =\mathbb E_{\tau\sim\pi_\theta(\tau)}[(\sum_{t=1}^Tlog\pi_\theta(a_t|s_t))(\sum_{t=1}^Tr(s_t,a_t))]
$$
è¿˜éœ€è¦æŒ‡å‡ºçš„æ˜¯ä¸Šè¿°è¡¨è¾¾å¼æè¿°äº†å½“å‰ç­–ç•¥$\pi_\theta$é€šè¿‡ä¸€è½®è·å¾—çš„å¯¼æ•°ï¼Œå‰é¢æˆ‘ä»¬å·²ç»æåˆ°è¿‡ç”±äºç­–ç•¥äº§ç”Ÿçš„æ˜¯éç¡®å®šçš„åŠ¨ä½œï¼Œå› æ­¤ç›¸åŒç­–ç•¥åœ¨å¤šè½®æ¬¡ä¸­ä¼šäº§ç”Ÿä¸åŒçš„è½¨è¿¹ï¼Œä¸ºäº†é¿å…ä¸ªä½“çš„åå·®ï¼Œæˆ‘ä»¬éœ€è¦å¤šæ¬¡å–æ ·å¹¶å»å‡å€¼æ¥æé«˜å‡†ç¡®æ€§ï¼Œæ‰€ä»¥ï¼Œ
$$
\nabla_\theta J(\theta) \approx \frac{1}{N}\sum_{i=1}^N[(\sum_{t=1}^Tlog\pi_\theta(a_{i,t}|s_{i,t}))(\sum_{t=1}^Tr(s_{i,t},a_{i,t}))]
$$
è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†å¯è®¡ç®—çš„ç›®æ ‡å‡½æ•°çš„å¯¼æ•°$\nabla J(\theta)$ï¼Œåœ¨è½®æ¬¡çš„åå‘ä¼ é€’(back propagation)ä¸­ä½¿ç”¨å­¦ä¹ ç‡$\alpha$ä¸$\nabla J(\theta)$çš„ä¹˜ç§¯ä½œä¸ºå·®å€¼$\delta$æ›´æ–°$\theta$
$$
\theta = \theta + \alpha \nabla J(\theta)
$$
ä»¥ä¸Šä¸ºäº†æ¨å¯¼ç”¨äºåå‘ä¼ é€’çš„å¯è®¡ç®—çš„$\nabla J(\theta)$åˆ—å‡ºäº†å¾ˆå¤šè¡¨è¾¾å¼ï¼Œç›®çš„æ˜¯å¸®åŠ©è¯»è€…ç†è§£PGç®—æ³•å®ç°ï¼Œå› ä¸ºåœ¨ä»£ç å®ç°ä¸­ä¼šç›´æ¥ä½¿ç”¨~~è¡¨è¾¾å¼x~~è®¡ç®—$\nabla J(\theta)$ï¼Œå¦‚æœç›´æ¥çœ‹ä»£ç è€Œä¸äº†è§£$\nabla J(\theta)$çš„å˜å½¢çš„è¯ææ€•ä¼šè§‰å¾—è´¹è§£ã€‚ä¸è¿‡ä»$\nabla_\theta J(\theta)$å’Œ$\pi_\theta(\tau)$$r(\tau)$çš„åŸºæœ¬å…³ç³»è¿˜æ˜¯èƒ½å¤Ÿä½œå‡ºè¿™æ ·çš„ç›´è§‚è§£é‡Šï¼šå¦‚æœå¥–åŠ±($r(\tau)$)æ¯”è¾ƒé«˜æ—¶ï¼Œç­–ç•¥($\pi_\theta(\tau)$)ä¼šå€¾å‘äºå¢åŠ ç›¸åº”çš„åŠ¨ä½œçš„æ¦‚ç‡ï¼Œå¦‚æœå¥–åŠ±æ¯”è¾ƒä½æ—¶ï¼Œç­–ç•¥ä¼šå€¾å‘äºé™ä½ç›¸åº”åŠ¨ä½œçš„æ¦‚ç‡ã€‚ä»æœºå™¨å­¦ä¹ çš„åŸç†çš„è§’åº¦æ¥çœ‹ï¼ŒPGå’Œä¼ ç»Ÿçš„ç›‘ç£å¼å­¦ä¹ çš„å­¦ä¹ è¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒç›¸ä¼¼çš„ï¼Œæ¯è½®æ¬¡éƒ½ç”±å‰å‘ä¼ é€’å’Œåå‘ä¼ é€’æ„æˆï¼Œå‰å‘ä¼ é€’è´Ÿè´£è®¡ç®—ç›®æ ‡å‡½æ•°ï¼Œåå‘ä¼ é€’è´Ÿè´£æ›´æ–°ç®—æ³•çš„å‚æ•°ï¼Œä¾æ­¤è¿›è¡Œå¤šè½®æ¬¡çš„å­¦ä¹ æŒ‡å¯¼å­¦ä¹ æ•ˆæœç¨³å®šæ”¶æ•›ã€‚å”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œç›‘ç£å¼å­¦ä¹ çš„ç›®æ ‡å‡½æ•°ç›¸å¯¹ç›´æ¥ï¼Œå³ç›®æ ‡å€¼å’ŒçœŸå®å€¼çš„å·®ï¼Œè¿™ä¸ªå€¼ä¸€æ¬¡å‰å‘ä¼ é€’å°±èƒ½å¾—åˆ°ï¼›è€ŒPGçš„ç›®æ ‡å‡½æ•°æºè‡ªè½®æ¬¡å†…æ‰€æœ‰å¾—åˆ°çš„å¥–åŠ±ï¼Œå¹¶ä¸”éœ€è¦è¿›è¡Œä¸€å®šçš„æ•°å­¦è½¬æ¢æ‰èƒ½è®¡ç®—ï¼Œå¦å¤–ç”±äºç”¨å–æ ·æ¨¡æ‹ŸæœŸæœ›ï¼Œä¹Ÿéœ€è¦å¯¹åŒä¸€å¥—å‚æ•°è¿›è¡Œå¤šæ¬¡å‰å‘ä¼ é€’æ¥å¢åŠ æ¨¡æ‹Ÿçš„å‡†ç¡®æ€§ã€‚
>å¯ä»¥çœ‹åˆ°å¼ºåŒ–å­¦ä¹ æœ‰åˆ«äºä¼ ç»Ÿçš„æœºå™¨å­¦ä¹ ï¼Œæˆ‘ä»¬æ˜¯ä¸èƒ½ç«‹å³å¾—åˆ°æ ‡è®°çš„ï¼Œè€Œåªèƒ½å¾—åˆ°ä¸€ä¸ªåé¦ˆï¼Œä¹Ÿå¯ä»¥è¯´å¼ºåŒ–å­¦ä¹ æ˜¯ä¸€ç§**æ ‡è®°å»¶è¿Ÿçš„ç›‘ç£å­¦ä¹ **
figure: intuition

ä»å®ç°è§’åº¦çœ‹ï¼ŒPGçš„å­¦ä¹ è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ
1. **å–æ ·**	å¯¹å½“å‰ç­–ç•¥å–å¤šä¸ªè½¨è¿¹ç”¨ä»¥å‡†ç¡®è®¡ç®—ç›®æ ‡å‡½æ•°ï¼Œå–æ ·çš„è¿‡ç¨‹å°±æ˜¯ç”¨å½“å‰ç­–ç•¥è¿›è¡Œå¤šæ¬¡å‰å‘ä¼ é€’å¹¶ä¿å­˜è½¨è¿¹
2. **è®¡ç®—$\nabla J(\theta)$**
3. **æ”¹è¿›ç­–ç•¥**	ä½¿ç”¨2è®¡ç®—å‡ºçš„$\nabla J(\theta)$æ›´æ–°$\theta$

### PGå®ç°


## PGçš„æ”¹è¿›
### å‡å°æ–¹å·®
è™½ç„¶PGç†è®ºä¸Šèƒ½å¤„ç†åŸºäºå€¼çš„æ–¹æ³•æ— æ³•å¤„ç†çš„å¤æ‚é—®é¢˜ï¼Œä½†ç”±äºPGä¾èµ–æ ·æœ¬æ¥ä¼˜åŒ–ç­–ç•¥ï¼Œå¯¼è‡´è¿™ç§æ–¹æ³•å—æ ·æœ¬ä¸ªä½“å·®å¼‚å½±å“æœ‰æ¯”è¾ƒå¤§çš„æ–¹å·®ï¼Œå­¦ä¹ çš„æ•ˆæœä¸å®¹æ˜“æŒç»­å¢å¼ºå’Œæ”¶æ•›ã€‚ä¸€ä¸ªåŸºæœ¬çš„æ”¹è¿›æ€è·¯æ˜¯é€šè¿‡å‡å°‘æ— æ•ˆçš„å…ƒç´ æ¥é™ä½æ–¹å·®ï¼Œç”±äºå½“å‰çš„åŠ¨ä½œä¸ä¼šå¯¹è¿‡å»çš„å¥–åŠ±äº§ç”Ÿå½±å“ï¼Œå› æ­¤å¯ä»¥å°†$\nabla_\theta J(\theta)$æ”¹å†™ä¸º
$$
\nabla_\theta J(\theta) \approx\frac{1}{N}\sum_{i=1}^N[(\sum_{t=1}^Tlog\pi_\theta(a_{i,t}|s_{i,t}))(\sum_{t'=t}^Tr(a_{i,t'}, s_{i, t'}))]
$$
æˆ‘ä»¬è¿˜å¯ä»¥å€Ÿé‰´MDPæŠ˜æ‰£ç³»æ•°çš„æ€æƒ³é™ä½æœªæ¥çš„å½±å“
$$
\nabla_\theta J(\theta) \approx\frac{1}{N}\sum_{i=1}^N[(\sum_{t=1}^Tlog\pi_\theta(a_{i,t}|s_{i,t}))(\sum_{t'=t}^T\gamma^{t'-t} r(a_{i,t'}, s_{i, t'}))]
$$
å¦å¤–ä¸€ä¸ªæ€è·¯æ˜¯é€šè¿‡å¼•å…¥åŸºå‡†(baseline)$b$å‡å°æ–¹å·®ï¼Œè¿™æ˜¯å› ä¸ºå®é™…è®¡ç®—ä¸­äº§ç”Ÿçš„æ€»å¥–åŠ±å¹¶ä¸èƒ½å‡†ç¡®ä»£è¡¨è¿™ä¸ªç­–ç•¥çš„å¥½åç¨‹åº¦ï¼Œæ¯”å¦‚æœ‰å¯èƒ½ä¸€ä¸ªä¸å¤ªå¥½çš„ç­–ç•¥ä¹Ÿèƒ½å¾—åˆ°ä¸€ä¸ªæ­£å‘çš„æ€»å¥–åŠ±
$$
\nabla_\theta J(\theta) \approx\frac{1}{N}\sum_{i=1}^N[(\sum_{t=1}^Tlog\pi_\theta(a_{i,t}|s_{i,t}))(\sum_{t'=t}^Tr(a_{i,t'}, s_{i, t'})-b)]
$$
å¸¸è§çš„åŸºå‡†å€¼æ˜¯å‡å€¼
$$
b=\frac{1}{N}\sum_{i=1}^N r(a_i, s_i)
$$
ç”±äº
$$
\mathbb E[\nabla_\theta log\pi(\tau)b]=\int \pi_\theta(\tau)\nabla_\ log _\theta(\tau)bd\tau=\int \pi_\theta(\tau)\nabla_\theta(\tau)bd\tau = b\nabla_\theta\int \pi_\theta(\tau)d\tau
$$
ç”±äº$\pi()$æ˜¯æ¦‚ç‡å¯†åº¦å‡½æ•°$\int \pi_\theta(\tau)d\tau=1$ï¼Œå› æ­¤
$$
\mathbb E[\nabla_\theta log\pi(\tau)b] = b\nabla_\theta1=0
$$
ç”±æ­¤æˆ‘ä»¬è¯æ˜äº†å¼•å…¥åŸºå‡†$b$ä¸ä¼šå¯¹$\nabla_\theta J(\theta)$äº§ç”Ÿå½±å“
### 
## æ€»ç»“

PGå…³é”®è¯æ˜¯æŠ½æ ·ï¼Œé€šè¿‡æŠ½æ ·æ¨¡æ‹Ÿç›®æ ‡å‡½æ•°ï¼Œé¿å…äº†éå†ï¼Œç”±äºæŠ½æ ·å¯¼è‡´è¾ƒå¤§çš„æ–¹æŸ¥


<!--stackedit_data:
eyJoaXN0b3J5IjpbMTk1MjE0MTU4NCwtNDc3MzMwMzE3LC04NT
gzMzc3MzQsMTQ1Mzc5NTg5Ml19
-->